<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Hydra-inspired configuration management tool for R • Rydra</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="A Hydra-inspired configuration management tool for R">
<meta name="description" content="Provides a simple way to manage configurations for calculations, inspired by Hydra.">
<meta property="og:description" content="Provides a simple way to manage configurations for calculations, inspired by Hydra.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">Rydra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="articles/pricing-model.html">Simple Pricing Model</a></li>
    <li><a class="dropdown-item" href="articles/insurance-risk-model.html">Insurance Risk Model</a></li>
    <li><a class="dropdown-item" href="articles/clinical-trial-patient-selection.html">Clinical Trial Patient Selection</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="rydra">Rydra<a class="anchor" aria-label="anchor" href="#rydra"></a>
</h1></div>
<p><strong>A Hydra-inspired configuration management tool for R</strong></p>
<p><code>Rydra</code> provides a simple and flexible way to manage configurations for complex calculations in R. It is inspired by the popular Python library <a href="https://hydra.cc/" class="external-link">Hydra</a>, and it allows you to define your calculations in a YAML file, which makes them easy to read, modify, and share.</p>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>To get started with <code>Rydra</code>, you first need to install the package from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"andjar/Rydra"</span><span class="op">)</span></span></code></pre></div>
<p>Once the package is installed, you can use the <code><a href="reference/rydra_calculate.html">rydra_calculate()</a></code> function to perform your calculations. This function takes the following arguments:</p>
<ul>
<li>
<code>config_path</code>: The path to your YAML configuration file.</li>
<li>
<code>data</code>: A list or a single-row data frame containing the input data for your calculation.</li>
<li>
<code>model_name</code>: (Optional) The name of the model configuration block in your YAML file to use. If omitted, you must specify a <code>model_name</code> at the YAML root; otherwise <code><a href="reference/rydra_calculate.html">rydra_calculate()</a></code> will error. There is no implicit fallback to the first model.</li>
<li>
<code>transformations</code>: (Optional) A named list of R functions to be made available for use in the <code>transformations</code> section of your YAML configuration.
<ul>
<li>By default, <code>Rydra</code> provides a set of base transformation functions: <code>center_variable</code>, <code>square_variable</code>, <code>log_transform</code>, <code>exp_transform</code>, <code>multiply_by</code>, <code>add_value</code>, and <code>truncate_variable</code>.</li>
<li>If you provide your own list to this argument, it will <em>replace</em> the default set. This means if you want to use a base function alongside your custom ones, you must include it in the list you provide.</li>
<li>Example: <code>list(my_custom_func = function(x) x*2, log_transform = Rydra::log_transform)</code>
</li>
<li>Provide <code>transformations = list()</code> to use <em>no</em> pre-defined R functions from Rydra, relying only on functions globally available in your R session or defined directly in sufficiently complex YAML transformation formulas (though passing functions is cleaner).</li>
</ul>
</li>
</ul>
<p>Here is an example of how to use the <code><a href="reference/rydra_calculate.html">rydra_calculate()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the Rydra package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andjar.github.io/Rydra/">Rydra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a sample input data</span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fl">35</span>,</span>
<span>  income <span class="op">=</span> <span class="fl">60000</span>,</span>
<span>  student <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  employment_status <span class="op">=</span> <span class="st">"Unemployed"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform the calculation using default base transformations</span></span>
<span><span class="co"># The `transformations` argument is omitted, so Rydra uses its defaults.</span></span>
<span><span class="co"># The example_config.yaml uses center_variable, square_variable, and log_transform.</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rydra_calculate.html">rydra_calculate</a></span><span class="op">(</span></span>
<span>  config_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_config.yaml"</span>, package <span class="op">=</span> <span class="st">"Rydra"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">input_data</span>,</span>
<span>  model_name <span class="op">=</span> <span class="st">"main_model"</span> <span class="co"># example_config.yaml uses 'main_model'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example of providing custom transformations (this would replace defaults):</span></span>
<span><span class="va">my_special_log</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span>, base <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">custom_transform_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  log_transform <span class="op">=</span> <span class="va">my_special_log</span>, <span class="co"># Overrides default log_transform</span></span>
<span>  center_variable <span class="op">=</span> <span class="fu">Rydra</span><span class="fu">::</span><span class="va"><a href="reference/center_variable.html">center_variable</a></span> <span class="co"># Still need center_variable for example_config</span></span>
<span>  <span class="co"># square_variable would be missing here if example_config needed it and we didn't add it</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># result_custom &lt;- rydra_calculate(</span></span>
<span><span class="co">#   config_path = system.file("extdata", "example_config.yaml", package = "Rydra"),</span></span>
<span><span class="co">#   data = input_data,</span></span>
<span><span class="co">#   model_name = "main_model",</span></span>
<span><span class="co">#   transformations = custom_transform_list</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># print(result_custom)</span></span>
<span></span>
<span><span class="co"># Example of providing no Rydra transformations (use if functions in YAML are globally defined):</span></span>
<span><span class="co"># result_no_defaults &lt;- rydra_calculate(</span></span>
<span><span class="co">#   config_path = system.file("extdata", "example_config.yaml", package = "Rydra"),</span></span>
<span><span class="co">#   data = input_data,</span></span>
<span><span class="co">#   model_name = "main_model",</span></span>
<span><span class="co">#   transformations = list() # This would likely cause errors for example_config.yaml</span></span>
<span><span class="co"># )</span></span>
<span><span class="co"># print(result_no_defaults)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="yaml-configuration-file">YAML Configuration File<a class="anchor" aria-label="anchor" href="#yaml-configuration-file"></a>
</h2>
<p>The YAML configuration file is the heart of the <code>Rydra</code> package. It allows you to define all the parameters, transformations, factors, and coefficients for your specific model. The configuration file has the following structure:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">model_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"simplified_model"</span><span class="co">  # Required if you omit the model_name argument</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">constants</span><span class="kw">:</span><span class="co">  # Optional. Include only if referenced by transformations</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="at">  </span><span class="fu">age</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="at">  </span><span class="fu">income</span><span class="kw">:</span><span class="at"> </span><span class="dv">50000</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="fu">main_model</span><span class="kw">:</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="at">  </span><span class="fu">intercepts</span><span class="kw">:</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="at">    </span><span class="fu">baseline</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.25</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="at">  </span><span class="fu">coefficients</span><span class="kw">:</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">    # Continuous variable coefficients</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="at">    </span><span class="fu">age_centered</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.05</span><span class="co">            # Coefficient keys must match variable names present AFTER transformations</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="at">    </span><span class="fu">age_squared_centered</span><span class="kw">:</span><span class="at"> </span><span class="fl">-0.02</span><span class="co">   # e.g., names created in the 'transformations' block</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="at">    </span><span class="fu">income_log</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.15</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">    # Coefficients for categorical variables</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="at">    </span><span class="fu">student_modifier</span><span class="kw">:</span><span class="at"> </span><span class="fl">-0.50</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="at">    </span><span class="fu">employment_unemployed</span><span class="kw">:</span><span class="at"> </span><span class="fl">-0.25</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="at">    </span><span class="fu">employment_self_employed</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.10</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="at">  </span><span class="fu">transformations</span><span class="kw">:</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_centered"</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="at">      </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"center_variable(age, constants.age)"</span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_squared_centered"</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="at">      </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"square_variable(age_centered)"</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"income_log"</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="at">      </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"log_transform(income)"</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="at">  </span><span class="fu">factors</span><span class="kw">:</span><span class="co"> # Optional</span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"student"</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="at">      </span><span class="fu">levels</span><span class="kw">:</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="at">          </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.baseline"</span><span class="co"> # Assuming 0 is the baseline, so no additional coefficient</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="at">          </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.student_modifier"</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"employment_status"</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="at">      </span><span class="fu">levels</span><span class="kw">:</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"Employed"</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="at">          </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.baseline"</span><span class="co"> # Baseline for employment status</span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"Unemployed"</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="at">          </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.employment_unemployed"</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"Self-employed"</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="at">          </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.employment_self_employed"</span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a><span class="at">  </span><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"truncate_variable(result, 0, 100)"</span></span></code></pre></div>
<div class="section level3">
<h3 id="transformations">Transformations<a class="anchor" aria-label="anchor" href="#transformations"></a>
</h3>
<p><code>Rydra</code> provides a set of built-in transformation functions that you can use in your YAML configuration file. These functions are:</p>
<ul>
<li>
<code>center_variable(x, center)</code>: Centers a variable by subtracting a centering value.</li>
<li>
<code>square_variable(x)</code>: Squares a variable.</li>
<li>
<code>log_transform(x, base = exp(1))</code>: Log-transforms a variable (natural log by default).</li>
<li>
<code>exp_transform(x, base = exp(1))</code>: Exponentiates a variable (e^x by default).</li>
<li>
<code>multiply_by(value, multiplier)</code>: Multiplies a value by a multiplier (useful in output transformations).</li>
<li>
<code>add_value(value, term)</code>: Adds a term to a value (useful in output transformations).</li>
<li>
<code>subtract_value(value, term)</code>: Subtracts a term from a value. Thin wrapper over <code>-</code> for readability and whitelisting.</li>
<li>
<code>divide_by(value, divisor)</code>: Divides a value by a divisor. Thin wrapper over <code>/</code>; errors on division by zero.</li>
<li>
<code>truncate_variable(x, min_val, max_val)</code>: Truncates a value to the [min, max] range.</li>
</ul>
<p>You can also use your own custom transformation functions. As explained in the “Getting Started” section, you can pass a named list of your functions via the <code>transformations</code> argument to <code>rydra_calculate</code>. If you do so, remember that this list <em>replaces</em> the default set of base transformations, so include any base functions you still need (e.g., <code>list(my_func = ..., log_transform = Rydra::log_transform)</code>).</p>
<div class="section level4">
<h4 id="nested-transformations">Nested Transformations<a class="anchor" aria-label="anchor" href="#nested-transformations"></a>
</h4>
<p><code>Rydra</code> supports nested transformations, where a transformation can use the result of a previous one. The transformations are executed in the order they are defined in the YAML file.</p>
<p>For example, the following is a valid sequence of transformations:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">transformations</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_centered"</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="at">    </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"center_variable(age, constants.age)"</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_squared_centered"</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="at">    </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"square_variable(age_centered)"</span></span></code></pre></div>
<p>In this example, <code>age_squared_centered</code> uses the result of <code>age_centered</code>.</p>
<p>While this is a powerful feature, for the sake of clarity and maintainability, we recommend avoiding deeply nested transformations. When possible, breaking down complex transformations into smaller, independent steps can make the configuration easier to read and debug.</p>
</div>
</div>
<div class="section level3">
<h3 id="factors">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h3>
<p>The <code>factors</code> section of the YAML configuration file allows you to define and manage categorical variables. Each factor has a <code>name</code> and a list of <code>levels</code>. Each <code>level</code> has a <code>value</code> (the actual value of the factor in your data) and a <code>coefficient</code> (the path to the coefficient in the <code>coefficients</code> or <code>intercepts</code> section that should be applied when this level is present). You should explicitly define all levels, including the baseline, to ensure proper validation and clarity. This section is optional—include it only if you need factor-based adjustments.</p>
</div>
<div class="section level3">
<h3 id="conditions">Conditions<a class="anchor" aria-label="anchor" href="#conditions"></a>
</h3>
<p>The <code>conditions</code> section allows you to apply additional coefficients based on logical expressions evaluated against the input data (after transformations). This is useful for implementing interaction effects, applying specific adjustments, or other conditional logic not easily covered by direct factors or transformations.</p>
<p>Each item in the <code>conditions</code> list must have: * <code>name</code>: A descriptive name for the condition. * <code>condition</code>: An R expression (as a string) that evaluates to <code>TRUE</code> or <code>FALSE</code>. This expression can reference any variable in your input <code>data</code> (including those created by <code>transformations</code>) and also elements from the model’s <code>intercepts</code> or <code>coefficients</code> blocks (e.g., <code>age &gt; intercepts.age_threshold</code>). * <code>coefficient</code>: A path string (e.g., <code>"coefficients.high_risk_adj"</code> or <code>"intercepts.special_bonus"</code>) to a numeric value within the current model’s configuration. If the condition evaluates to <code>TRUE</code>, this numeric value is added to the total score.</p>
<p><strong>Example of a <code>conditions</code> block:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Inside your model_name block (e.g., main_model)</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="at">  </span><span class="fu">intercepts</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="at">    </span><span class="fu">baseline</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.25</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="at">    </span><span class="fu">special_bonus</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.75</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="at">    </span><span class="fu">age_threshold</span><span class="kw">:</span><span class="at"> </span><span class="dv">50</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="at">  </span><span class="fu">coefficients</span><span class="kw">:</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="at">    </span><span class="fu">age_centered</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.05</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">    # ... other coefficients ...</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="at">    </span><span class="fu">high_risk_adj</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.25</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="at">  </span><span class="fu">transformations</span><span class="kw">:</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_centered"</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="at">      </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"center_variable(age, centering.age)"</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">    # ... other transformations ...</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="at">  </span><span class="fu">factors</span><span class="kw">:</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">    # ... your factors ...</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="at">  </span><span class="fu">conditions</span><span class="kw">:</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"high_risk_adjustment"</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="at">      </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_centered &gt; 10 &amp;&amp; some_other_variable == 'CategoryA'"</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="at">      </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.high_risk_adj"</span><span class="co"> # Adds 0.25 if condition is met</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"senior_bonus_if_employed"</span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="at">      </span><span class="fu">condition</span><span class="kw">:</span><span class="at"> </span><span class="st">"age &gt; intercepts.age_threshold &amp;&amp; employment_status == 'Employed'"</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="at">      </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"intercepts.special_bonus"</span><span class="co">    # Adds 0.75 if condition is met</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co"># ...</span></span></code></pre></div>
<p>If a condition’s expression is TRUE, the numeric value found at the specified <code>coefficient</code> path is added to the score. If FALSE, it contributes nothing.</p>
</div>
<div class="section level3">
<h3 id="output-transformation">Output Transformation<a class="anchor" aria-label="anchor" href="#output-transformation"></a>
</h3>
<p>The <code>output_transformation</code> section of the YAML configuration file allows you to apply a final transformation to the calculated score. This transformation <strong>must</strong> be a call to a function that is available in the <code>transformations</code> list provided to (or defaulted by) the <code>rydra_calculate</code> function.</p>
<p>The transformation string should be in the format <code>"function_name(arguments)"</code>. The special variable <code>result</code> (which holds the total aggregated score before this final step) <strong>must</strong> be used as one of the arguments to the function. This mechanism is intended for final scaling, unit conversions, or applying caps/floors using predefined and allowed transformation functions. Raw R code or arbitrary expressions are no longer permitted here to ensure better control and clarity.</p>
<p>Available built-in transformation functions (which can be used if they are part of the active <code>transformations</code> list) suitable for output transformations include: * <code>multiply_by(value, multiplier)</code>: Multiplies the <code>value</code> by <code>multiplier</code>. * <code>add_value(value, term)</code>: Adds <code>term</code> to <code>value</code>. * Standard R functions like <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code>, <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax()</a></code> can also be used if they are part of the <code>transformations</code> list (note: base R functions are not included by default in the <code>transformations</code> list; only those explicitly defined in <code>Rydra:::.default_rydra_transformations</code> or user-provided lists). To use base R functions, you would typically wrap them or add them to the list passed to <code>rydra_calculate</code>. For simplicity, <code>log_transform</code> and <code>exp_transform</code> are provided by default.</p>
<p><strong>Examples in YAML:</strong></p>
<p>To truncate the result to a minimum of 0 and a maximum of 100:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"truncate_variable(result, 0, 100)"</span></span></code></pre></div>
<p>To scale the result by 100:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"multiply_by(result, 100)"</span></span></code></pre></div>
<p>To add 5 to the result:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"add_value(result, 5)"</span></span></code></pre></div>
<p>To subtract 5 from the result:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"subtract_value(result, 5)"</span></span></code></pre></div>
<p>To divide the result by 100:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"divide_by(result, 100)"</span></span></code></pre></div>
<p>The <code>log_transform</code> function (available by default) can also be used:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"log_transform(result, base = 10)"</span></span></code></pre></div>
<p><strong>Important:</strong> * The function used (e.g., <code>multiply_by</code>) must be present in the named list of functions provided via the <code>transformations</code> argument to <code>rydra_calculate</code> (or be part of Rydra’s default set). * The expression must be a single function call. * The <code>result</code> variable must be explicitly passed as an argument to the function.</p>
</div>
<div class="section level3">
<h3 id="example-score-calculation-walkthrough">Example: Score Calculation Walkthrough<a class="anchor" aria-label="anchor" href="#example-score-calculation-walkthrough"></a>
</h3>
<p>Let’s walk through how a score is calculated with a medium-complex example. We’ll use a hypothetical model configuration similar to <code>main_model</code> found in <code>inst/extdata/example_config.yaml</code>.</p>
<p><strong>Sample Input Data:</strong></p>
<ul>
<li>
<code>age</code>: 40</li>
<li>
<code>income</code>: 70000</li>
<li>
<code>student</code>: 1 (true/active student)</li>
<li>
<code>employment_status</code>: “Unemployed”</li>
</ul>
<p><strong>Relevant YAML Configuration Snippets:</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">constants</span><span class="kw">:</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="at">  </span><span class="fu">age</span><span class="kw">:</span><span class="at"> </span><span class="dv">30</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="at">  </span><span class="fu">income</span><span class="kw">:</span><span class="at"> </span><span class="dv">50000</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co"># model_name: example_calculation_model (hypothetical)</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu">intercepts</span><span class="kw">:</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="at">  </span><span class="fu">baseline</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.25</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="fu">coefficients</span><span class="kw">:</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="at">  </span><span class="fu">age_centered</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.05</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="at">  </span><span class="fu">age_squared_centered</span><span class="kw">:</span><span class="at"> </span><span class="fl">-0.02</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="at">  </span><span class="fu">income_log</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.15</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="at">  </span><span class="fu">student_modifier</span><span class="kw">:</span><span class="at"> </span><span class="fl">-0.50</span><span class="co">             # Used by factors</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="at">  </span><span class="fu">employment_unemployed</span><span class="kw">:</span><span class="at"> </span><span class="fl">-0.25</span><span class="co">      # Used by factors</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">  # (other coefficients for different factor levels or conditions might exist)</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="fu">transformations</span><span class="kw">:</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_centered"</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="at">    </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"center_variable(age, constants.age)"</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"age_squared_centered"</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="at">    </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"square_variable(age_centered)"</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"income_log"</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="at">    </span><span class="fu">formula</span><span class="kw">:</span><span class="at"> </span><span class="st">"log_transform(income)"</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="fu">factors</span><span class="kw">:</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"student"</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="at">    </span><span class="fu">levels</span><span class="kw">:</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="at">        </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.baseline_student_effect"</span><span class="co"> # Hypothetical baseline effect</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="at">        </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.student_modifier"</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">"employment_status"</span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a><span class="at">    </span><span class="fu">levels</span><span class="kw">:</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"Employed"</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a><span class="at">        </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.baseline_employment_effect"</span><span class="co"> # Hypothetical</span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">value</span><span class="kw">:</span><span class="at"> </span><span class="st">"Unemployed"</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="at">        </span><span class="fu">coefficient</span><span class="kw">:</span><span class="at"> </span><span class="st">"coefficients.employment_unemployed"</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a><span class="co">      # (other levels)</span></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a><span class="co"># conditions: (Assume no conditions for this specific example for simplicity, or they evaluate to 0)</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="co">#   - name: "some_condition"</span></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a><span class="co">#     condition: "age_centered &gt; 15"</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a><span class="co">#     coefficient: "coefficients.conditional_add_on"</span></span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a><span class="fu">output_transformation</span><span class="kw">:</span><span class="at"> </span><span class="st">"truncate_variable(result, 0, 100)"</span></span></code></pre></div>
<p><strong>Calculation Steps:</strong></p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Apply Transformations:</strong></p>
<ul>
<li>
<code>age_centered</code>: <code>center_variable(40, centering.age=30)</code> = <code>40 - 30</code> = <code>10</code>
</li>
<li>
<code>age_squared_centered</code>: <code>square_variable(age_centered=10)</code> = <code>10^2</code> = <code>100</code>
</li>
<li>
<code>income_log</code>: <code>log_transform(income=70000)</code> (natural log) ≈ <code>11.15625</code>
</li>
<li>The <code>transformed_data</code> available for subsequent steps will include these values alongside the original data.</li>
</ul>
</li>
<li>
<p><strong>Calculate Base Score:</strong> This score includes the baseline intercept plus the sum of (direct coefficient * transformed variable value).</p>
<ul>
<li>
<code>intercept</code>: <code>1.25</code> (from <code>intercepts.baseline</code>)</li>
<li>Direct coefficient contributions:
<ul>
<li>
<code>age_centered</code>: <code>0.05 * 10</code> = <code>0.5</code>
</li>
<li>
<code>age_squared_centered</code>: <code>-0.02 * 100</code> = <code>-2.0</code>
</li>
<li>
<code>income_log</code>: <code>0.15 * 11.15625</code> = <code>1.6734375</code>
</li>
</ul>
</li>
<li>
<code>base_score</code> = <code>1.25 + 0.5 - 2.0 + 1.6734375</code> = <code>1.4234375</code>
</li>
</ul>
</li>
<li>
<p><strong>Calculate Factor Coefficients Sum (<code>factor_coeffs_sum</code>):</strong> This sum comes from looking up the coefficients associated with the active levels of categorical variables.</p>
<ul>
<li>
<strong>Factor “student”</strong>: Input <code>student</code> is <code>1</code>.
<ul>
<li>The YAML maps level <code>1</code> to <code>coefficients.student_modifier</code>, which is <code>-0.50</code>.</li>
</ul>
</li>
<li>
<strong>Factor “employment_status”</strong>: Input <code>employment_status</code> is <code>"Unemployed"</code>.
<ul>
<li>The YAML maps this level to <code>coefficients.employment_unemployed</code>, which is <code>-0.25</code>.</li>
</ul>
</li>
<li>
<code>factor_coeffs_sum</code> = <code>-0.50 + (-0.25)</code> = <code>-0.75</code>
</li>
</ul>
</li>
<li>
<p><strong>Calculate Conditional Coefficients Sum (<code>conditional_coeffs_sum</code>):</strong> This sum comes from any <code>conditions</code> that evaluate to true. For this example, we assume no conditions are met or defined.</p>
<ul>
<li>
<code>conditional_coeffs_sum</code> = <code>0</code>
</li>
</ul>
</li>
<li><p><strong>Calculate Total Score (before output transformation):</strong> <code>total_score</code> = <code>base_score + factor_coeffs_sum + conditional_coeffs_sum</code> <code>total_score</code> = <code>1.4234375 + (-0.75) + 0</code> = <code>0.6734375</code></p></li>
<li>
<p><strong>Apply Output Transformation:</strong> The <code>output_transformation</code> is <code>truncate_variable(result, 0, 100)</code>.</p>
<ul>
<li>
<code>final_result</code> = <code>truncate_variable(0.6734375, 0, 100)</code> = <code>0.6734375</code> (since it is within the range)</li>
</ul>
</li>
</ol>
<p>This <code>final_result</code> of <code>0.6734375</code> is what <code><a href="reference/rydra_calculate.html">rydra_calculate()</a></code> would return for this input data and configuration.</p>
</div>
</div>
<div class="section level2">
<h2 id="logging-calculations">Logging Calculations<a class="anchor" aria-label="anchor" href="#logging-calculations"></a>
</h2>
<p><code>Rydra</code> supports optional logging of calculation details to JSON files. This can be useful for debugging, auditing, or reproducing specific calculations.</p>
<p>To enable logging, add a <code>logging</code> section to the root of your YAML configuration file:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># At the root of your config.yaml, alongside model_name, centering, etc.</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="fu">logging</span><span class="kw">:</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="at">  </span><span class="fu">enabled</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">  # Set to true to enable logging</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="at">  </span><span class="fu">path</span><span class="kw">:</span><span class="at"> </span><span class="st">"calculation_logs"</span><span class="co"> # Optional: directory to store log files</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">                           # Defaults to "./rydra_logs/" if enabled and path is not specified</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">                           # Path is relative to the current working directory when rydra_calculate is run.</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">model_name</span><span class="kw">:</span><span class="at"> </span><span class="st">"simplified_model"</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="fu">centering</span><span class="kw">:</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">  # ... rest of your configuration</span></span></code></pre></div>
<div class="section level3">
<h3 id="log-file-content">Log File Content<a class="anchor" aria-label="anchor" href="#log-file-content"></a>
</h3>
<p>When logging is enabled, <code>Rydra</code> will create a JSON file for each call to <code>rydra_calculate</code>. The files are named using a timestamp and a unique UUID, for example: <code>20231027153000123456_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.json</code>.</p>
<p>Each log file contains the following information:</p>
<ul>
<li>
<code>timestamp</code>: The date and time (ISO 8601 format) when the calculation was performed.</li>
<li>
<code>invocation_params</code>:
<ul>
<li>
<code>config_path</code>: Path to the YAML configuration file used.</li>
<li>
<code>model_name</code>: The name of the model used from the configuration.</li>
<li>
<code>data</code>: The original input data provided to <code>rydra_calculate</code>.</li>
</ul>
</li>
<li>
<code>model_config_used</code>: The specific part of the configuration that corresponds to the <code>model_name</code> used for the calculation.</li>
<li>
<code>intermediate_values</code>:
<ul>
<li>
<code>input_data_processed_for_calc</code>: Input data after initial processing (e.g., if a multi-row data frame was input, only the first row is taken and converted to a list).</li>
<li>
<code>transformed_data</code>: The data after all transformations have been applied.</li>
<li>
<code>factor_coeffs_sum</code>: The sum of coefficients derived from the <code>factors</code> section.</li>
<li>
<code>base_score</code>: The score calculated from intercepts and direct coefficients multiplied by transformed data values.</li>
<li>
<code>conditional_coeffs_sum</code>: The sum of coefficients applied due to met <code>conditions</code>.</li>
<li>
<code>total_score_pre_output_transform</code>: The total score before the final <code>output_transformation</code> is applied.</li>
</ul>
</li>
<li>
<code>final_result</code>: The final result of the calculation after all steps, including the output transformation.</li>
</ul>
</div>
<div class="section level3">
<h3 id="dependencies-for-logging">Dependencies for Logging<a class="anchor" aria-label="anchor" href="#dependencies-for-logging"></a>
</h3>
<p>The logging feature uses the following R packages, which will be installed as dependencies of <code>Rydra</code>: * <code>jsonlite</code>: For writing data to JSON format. * <code>uuid</code>: For generating unique identifiers for log filenames.</p>
<p>If logging fails for any reason (e.g., the specified path is not writable), <code>Rydra</code> will issue a warning, but the main calculation will proceed as normal.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing Rydra</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Anders Hagen Jarmund <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/andjar/Rydra/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/andjar/Rydra/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anders Hagen Jarmund.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
